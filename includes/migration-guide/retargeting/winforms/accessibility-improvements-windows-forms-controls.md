### <a name="accessibility-improvements-in-windows-forms-controls"></a>Улучшения специальных возможностей для элементов управления Windows Forms

|   |   |
|---|---|
|Подробные сведения|В Windows Forms улучшено использование специальных возможностей, обеспечивающих большее удобство для пользователей Windows Forms. Внесены следующие изменения:<ul><li>Изменения для улучшения видимости в режиме высокой контрастности.</li><li>Изменения для улучшения работы с обозревателем свойств. Список усовершенствований обозревателя свойств включает:</li><li>Улучшенная навигация с помощью клавиатуры посредством различных окон выбора с раскрывающимися списками.</li><li>Уменьшение числа ненужных позиций табуляции.</li><li>Улучшенные отчеты о типах элементов управления.</li><li>Улучшенная работа экранного диктора.</li><li>Изменения в реализации отсутствующих шаблонов специальных возможностей пользовательского интерфейса в элементах управления.</li></ul>|
|Предложение|<strong>Как принять или отклонить изменения</strong>Чтобы эти изменения можно было использовать в приложении, оно должно быть запущено на платформе .NET Framework 4.7.1 или более поздней версии. В приложении эти изменения можно использовать одним из следующих способов:<ul><li>Выполнить повторную компиляцию, чтобы нацелить приложение на .NET Framework 4.7.1. Эти специальные возможности включены по умолчанию для приложений Windows Forms, ориентированных на .NET Framework 4.7.1 или более поздней версии.</li><li>Для отказа от функций специальных возможностей предыдущих версий [переключатель AppContext](~/docs/framework/configure-apps/file-schema/runtime/appcontextswitchoverrides-element.md) добавляется в раздел <code>&lt;runtime&gt;</code> файла конфигурации приложения и получает значение <code>false</code>, как показано в следующем примере.</li></ul><pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#13;&#10;&lt;configuration&gt;&#13;&#10;&lt;startup&gt;&#13;&#10;&lt;supportedRuntime version=&quot;v4.0&quot; sku=&quot;.NETFramework,Version=v4.7&quot;/&gt;&#13;&#10;&lt;/startup&gt;&#13;&#10;&lt;runtime&gt;&#13;&#10;&lt;!-- AppContextSwitchOverrides value attribute is in the form of &#39;key1=true/false;key2=true/false  --&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.UseLegacyAccessibilityFeatures=false&quot; /&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;&lt;/configuration&gt;&#13;&#10;</code></pre>В приложениях, предназначенных для .NET Framework 4.7.1 или более поздней версии, где требуется сохранить предыдущие функции специальных возможностей, можно выбрать прежние функции специальных возможностей, явно установив этот переключатель AppContext в значение <code>true</code>. Общие сведения об автоматизации пользовательского интерфейса см. в [этом разделе](~/docs/framework/ui-automation/ui-automation-overview.md). <strong>Добавлена поддержка шаблонов и свойств автоматизации пользовательского интерфейса</strong>Клиенты специальных возможностей могут использовать новые функции специальных возможностей WinForms с помощью общих шаблонов вызова с открытым описанием. Эти шаблоны предназначены не только для WinForms. Например, клиенты специальных возможностей могут вызывать метод QueryInterface для интерфейса IAccessible (MAAS), чтобы получить интерфейс IServiceProvider. Если этот интерфейс доступен, клиенты могут использовать его метод QueryService для запроса интерфейса IAccessibleEx. Дополнительные сведения см. в разделе [Использование интерфейса IAccessibleEx из клиента](https://msdn.microsoft.com/library/windows/desktop/dd561924.aspx). Начиная с версии .NET Framework 4.7.1, интерфейсы IServiceProvider и [IAccessibleEx](https://msdn.microsoft.com/library/windows/desktop/dd561898.aspx) (где применимо) доступны объектам специальных возможностей WinForms. В .NET Framework 4.7.1 добавлена поддержка следующих шаблонов и свойств автоматизации пользовательского интерфейса:<ul><li>Элементы управления <code>T:System.Windows.Forms.ToolStripSplitButton</code> и <code>T:System.Windows.Forms.ComboBox</code> поддерживают [шаблон развертывания/свертывания](~/docs/framework/ui-automation/implementing-the-ui-automation-expandcollapse-control-pattern.md).</li><li>Элемент управления <code>T:System.Windows.Forms.ToolStripMenuItem</code> использует для свойства [ControlType](~/docs/framework/ui-automation/ui-automation-support-for-the-menubar-control-type.md) значение <xref:System.Windows.Automation.ControlType.MenuItem?displayProperty=nameWithType>.</li><li>Элемент управления <code>T:System.Windows.Forms.ToolStripItem</code> поддерживает свойство [Name](xref:System.Windows.Automation.AutomationElement.NameProperty) и [шаблон развертывания/свертывания](~/docs/framework/ui-automation/implementing-the-ui-automation-expandcollapse-control-pattern.md).</li><li>Элемент управления <code>T:System.Windows.Forms.ToolStripDropDownItem</code> поддерживает <xref:System.Windows.Forms.AccessibleEvents> с указанием StateChange и NameChange при развертывании или свертывании раскрывающегося списка.</li><li>Элемент управления <code>T:System.Windows.Forms.ToolStripDropDownButton</code> использует для свойства [ControlType](~/docs/framework/ui-automation/ui-automation-support-for-the-menubar-control-type.md) значение <xref:System.Windows.Automation.ControlType.MenuItem?displayProperty=nameWithType>.</li><li>Элемент управления <code>T:System.Windows.Forms.DataGridViewCheckBoxCell</code> поддерживает [шаблон переключения](xref:System.Windows.Automation.TogglePattern).</li><li>Элементы управления <code>T:System.Windows.Forms.NumericUpDown</code> и <code>T:System.Windows.Forms.DomainUpDown</code> поддерживают [Name](xref:System.Windows.Automation.AutomationElement.NameProperty) и используют для свойства [ControlType](~/docs/framework/ui-automation/ui-automation-support-for-the-spinner-control-type.md) значение <xref:System.Windows.Automation.ControlType.Spinner?displayProperty=nameWithType>.</li></ul><strong>Улучшения элемента управления PropertyGrid</strong>В .NET Framework 4.7.1 добавлены следующие улучшения браузерного элемента управления PropertyBrowser:<ul><li>Кнопка <strong>Подробнее</strong> в диалоговом окне ошибки, которое появляется при вводе пользователем неверного значения в элемент управления <code>T:System.Windows.Forms.PropertyGrid</code>, поддерживает [шаблон развертывания/свертывания](~/docs/framework/ui-automation/implementing-the-ui-automation-expandcollapse-control-pattern.md), уведомления об изменении имени и состояния, а также свойство [ControlType](~/docs/framework/ui-automation/ui-automation-support-for-the-menubar-control-type.md) со значением <xref:System.Windows.Automation.ControlType.MenuItem?displayProperty=nameWithType>.</li><li>Область сообщений, которая отображается при развертывании кнопки <strong>Подробнее</strong> в диалоговом окне ошибки, теперь доступна с клавиатуры и поддерживает объявление содержимого сообщения об ошибке с помощью экранного диктора.</li><li>Значение <xref:System.Windows.Forms.AccessibleRole> для строк в элементе управления <code>T:System.Windows.Forms.PropertyGrid</code> изменилось со &quot;Строка&quot; на &quot;Ячейка&quot;. Ячейка сопоставляется с типом элемента управления &quot;DataItem&quot; модели автоматизации пользовательского интерфейса, благодаря чему обеспечивается поддержка соответствующих сочетаний клавиш и объявлений экранного диктора.</li><li>Строки элемента управления <code>T:System.Windows.Forms.PropertyGrid</code>, которые представляют элементы заголовка в том случае, если для элемента управления <code>T:System.Windows.Forms.PropertyGrid</code> свойство <code>P:System.Windows.Forms.PropertySort</code> имеет значение <code>F:System.Windows.Forms.PropertySory.Categorized</code>, имеют значение свойства [ControlType](~/docs/framework/ui-automation/ui-automation-support-for-the-menubar-control-type.md), равное <xref:System.Windows.Automation.ControlType.Button?displayProperty=nameWithType></li><li>Строки элемента управления <code>T:System.Windows.Forms.PropertyGrid</code>, которые представляют элементы заголовка в том случае, если для элемента управления <code>T:System.Windows.Forms.PropertyGrid</code> свойство <code>P:System.Windows.Forms.PropertySort</code> имеет значение <code>F:System.Windows.Forms.PropertySory.Categorized</code>, поддерживают [шаблон развертывания/свертывания](~/docs/framework/ui-automation/implementing-the-ui-automation-expandcollapse-control-pattern.md).</li><li>Улучшена навигация с помощью клавиатуры между сеткой и расположенной над ней панелью инструментов. При нажатии клавиш &quot;SHIFT+TAB&quot; теперь выбирается не вся панель инструментов, а только ее первая кнопка</li><li>Элементы управления <code>T:System.Windows.Forms.PropertyGrid</code>, отображаемые в режиме высокой контрастности, теперь отрисовывают прямоугольник фокуса вокруг кнопки панели инструментов, которая соответствует текущему значению свойства <code>P:System.Windows.Forms.PropertySort</code>.</li><li>Элементы управления <code>T:System.Windows.Forms.PropertyGrid</code>, которые отображаются в режиме высокой контрастности и имеют свойство <code>P:System.Windows.Forms.PropertySort</code>, равное <code>F:System.Windows.Forms.PropertySory.Categorized</code>, теперь используют цвет высокой контрастности для отображения фона заголовков категорий.</li><li>Элементы управления <code>T:System.Windows.Forms.PropertyGrid</code> обеспечивают более заметные различия между находящимися в фокусе элементами панели инструментов и теми элементами панели инструментов, которые указывают текущее значение свойства <code>P:System.Windows.Forms.PropertySort</code>. Это исправление включает в себя изменение режима высокой контрастности, а также изменения других сценариев.</li><li>Элементы панели инструментов для элемента управления <code>T:System.Windows.Forms.PropertyGrid</code>, которые указывают текущее значение свойства <code>P:System.Windows.Forms.PropertySort</code>, поддерживают [шаблон переключения](xref:System.Windows.Automation.TogglePattern).</li><li>Улучшенная поддержка экранного диктора для различения выбранного режима выравнивания в соответствующем средстве.</li><li>Если в форме отображается пустой элемент управления <code>T:System.Windows.Forms.PropertyGrid</code>, он будет получать фокус в тех случаях, в которых это ранее не происходило.</li></ul><strong>Использование определенных в ОС цветов в темах высокой контрастности</strong><ul><li>Элементы управления <code>T:System.Windows.Forms.Button</code> и <code>T:System.Windows.Forms.CheckBox</code>, для которых свойству <code>P:System.Windows.Forms.Control.FlatStyle</code> присвоено значение <xref:System.Windows.Forms.FlatStyle.System?displayProperty=nameWithType> (стиль по умолчанию), теперь используют определенные в ОС цвета при выборе темы высокой контрастности. Ранее цвета текста и фона не были контрастными, что ухудшало разборчивость.</li><li>Элементы управления <code>T:System.Windows.Forms.Button</code>, <code>T:System.Windows.Forms.CheckBox</code>, <code>T:System.Windows.Forms.RadioButton</code>, <code>T:System.Windows.Forms.Label</code>, <code>T:System.Windows.Forms.LinkLabel</code> и <code>T:System.Windows.Forms.GroupBox</code>, для которых свойству <code>P:System.Windows.Forms.Control.Enabled</code> присвоено значение <em>false</em>, использовали затененный цвет для отображения текста в темах высокой контрастности, в результате чего не обеспечивался достаточный контраст между текстом и фоном. Теперь для этих элементов управления используется цвет &quot;Выключенный текст&quot;, определенный в ОС. Это исправление применяется к элементам управления, для которых свойству <code>P:System.Windows.Forms.Control.FlatStyle</code> присвоено значение, отличное от <code>F:System.Windows.Forms.FlatStyle.System</code>. Последние элементы управления отображаются операционной системой.</li><li><code>T:System.Windows.Forms.DataGridView</code> теперь отображает видимый прямоугольник вокруг содержимого ячейки, в которой в данный момент установлен фокус. Ранее в некоторых темах высокой контрастности этот прямоугольник был незаметен.</li><li>Элементы управления <code>T:System.Windows.Forms.ToolStripMenuItem</code>, для которых свойству <code>P:System.Windows.Forms.ToolStripItem.Enabled</code> присвоено значение <em>false</em>, теперь используют цвет &quot;Выключенный цвет&quot;, определенный в ОС.</li><li>Элементы управления <code>T:System.Windows.Forms.ToolStripMenuItem</code>, для которых свойству <code>P:System.Windows.Forms.ToolStripItem.Checked</code> присвоено значение <em>true</em>, теперь отображают соответствующий флажок с использованием контрастного системного цвета.  Ранее цвет флажка был недостаточно контрастным, в результате чего он был не виден в некоторых темах высокой контрастности.</li></ul>ПРИМЕЧАНИЕ. В Windows 10 изменены значения некоторых системных цветов для тем высокой контрастности. Платформа Windows Forms Framework построена на основе Win32. Для достижения наилучших результатов используйте самую последнюю версию Windows и согласитесь на последние изменения операционной системы, добавив файл app.manifest в тестовое приложение и раскомментировав следующий код:<pre><code>&lt;!-- Windows 10 --&gt;&#13;&#10;&lt;supportedOS Id=&quot;{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}&quot; /&gt;&#13;&#10;</code></pre><strong>Улучшение навигации с помощью клавиатуры</strong><ul><li>Если для элемента управления <code>T:System.Windows.Forms.ComboBox</code> свойство <code>P:System.Windows.Forms.ComboBox.DropDownStyle</code> имеет значение <code>F:System.Windows.Forms.DropDownStyle.DropDownList</code> и он является первым элементом управления на вкладке формы, при открытии родительской формы с помощью клавиатуры он теперь отображает прямоугольник фокуса. До этого изменения фокус устанавливался в этот элемент управления, однако индикатор фокуса не отображался.</li></ul><strong>Улучшенная поддержка экранного диктора</strong><ul><li>Для элемента управления <code>T:System.Windows.Forms.MonthCalendar</code> добавлена поддержка вспомогательных технологий, обеспечивающих доступ к элементу управления, в том числе возможность объявления значения элемента управления с помощью экранного диктора, которая ранее отсутствовала.</li><li>Элемент управления <code>T:System.Windows.Forms.CheckedListBox</code> теперь направляет в экранный диктор уведомления об изменении свойства <code>P:System.Windows.Forms.CheckState</code>. Ранее экранный диктор не получал уведомления, в результате чего пользователи на знали об обновлении <code>P:System.Windows.Forms.CheckState</code>.</li><li>Для элемента управления <code>T:System.Windows.Forms.LinkLabel</code> изменился способ уведомления экранного диктора о тексте элемента управления. Ранее экранный диктор объявлял этот текст дважды и читал символы &quot;&amp;&quot; как реальный текст, хотя они не были видны пользователю. Из объявлений экранного диктора исключены ненужные символы &quot;&amp;&quot; и повторяющийся текст.</li><li>Типы элемента управления <code>T:System.Windows.Forms.DataGridViewCell</code> теперь корректно сообщают о состоянии только для чтения экранному диктору и другим вспомогательным технологиям.</li><li>Экранный диктор теперь может читать системное меню дочерних окон в приложениях с [многодокументным интерфейсом](~/docs/framework/winforms/advanced/multiple-document-interface-mdi-applications.md).</li><li>Экранный диктор теперь может читать элементы управления <code>T:System.Windows.Forms.ToolStripMenuItem</code>, для которых свойству <code>P:System.Windows.Forms.ToolStripItem.Enabled</code> присвоено значение <em>false</em>. Ранее экранный диктор не мог получить фокус для отключенных пунктов меню, чтобы считывать их содержимое.</li></ul>|
|Область|Значительно|
|Версия|4.7.1|
|Тип|Изменение целевой платформы|
|Затронутые API|<ul><li><xref:System.Windows.Forms.ToolStripDropDownButton.CreateAccessibilityInstance?displayProperty=nameWithType></li><li><xref:System.Windows.Forms.DomainUpDown.DomainUpDownAccessibleObject.Name?displayProperty=nameWithType></li><li>[MonthCalendar.AccessibilityObject](xref:System.Windows.Forms.Control.AccessibilityObject)</li></ul>|

