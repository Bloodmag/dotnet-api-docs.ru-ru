### <a name="wpf-grid-allocation-of-space-to-star-columns"></a>Выделение пространства для *-столбцов в элементе Grid WPF

|   |   |
|---|---|
|Подробные сведения|Начиная с версии .NET Framework 4.7, WPF заменяет алгоритм, который использовался в элементе <xref:System.Windows.Controls.Grid> для выделения пространства для *-столбцов. В результате изменяется фактическая ширина, назначенная *-столбцам в ряде случаев:<ul><li>Если один или несколько *-столбцов также имеют минимальную или максимальную ширину, переопределяющую пропорциональное выделение для этого столбца. (Минимальная ширина может быть производной от явного объявления MinWidth или неявного минимума, полученного из содержимого столбца. Максимальная ширина может быть определена только явным образом в объявлении MaxWidth.)</li><li>Когда один или несколько *-столбцов объявляют слишком большой *-вес — более 10^298.</li><li>Когда *-веса достаточно отличаются, приводя к нестабильности операций с плавающей запятой (переполнение, нехватка данных, потеря точности).</li><li>Когда включено округление макета, а действующее значение DPI дисплея достаточно высокое.</li></ul>В первых двух случаях значения ширины, создаваемые новым алгоритмом, могут значительно отличаться от созданных старым алгоритмом; в последнем случае разница будет равна максимум одному или двум пикселям. Новый алгоритм устраняет некоторые ошибки, присутствующие в старом алгоритме:<ol><li>Общее выделенное пространство для столбцов может превышать ширину сетки. Это может произойти при выделении пространства для столбца, пропорциональная доля которого меньше его минимального размера. Алгоритм выделяет минимальный размер, что уменьшает пространство, доступное для других столбцов. Если не осталось *-столбцов для выделения, общее выделенное пространство будет слишком большим.</li><li>Общее выделенное пространство может быть меньше ширины сетки. Эта смежная с первой проблема возникает при выделении пространства для столбца, пропорциональная доля которого больше его максимального размера, когда не остается *-столбцов для заполнения зарезервированного пространства.</li><li>Два *-столбца могут получить выделенное пространство, непропорциональное их весу. Это более мягкая версия первой или второй проблемы возникает при выделении пространства для *-столбцов A, B и C (в таком порядке), когда пропорциональная доля столбца B нарушает его минимальное (или максимальное) ограничение. Как показано выше, при этом изменяется место, доступное для столбца C, который получает меньше (или больше) пропорционально выделенного пространства, чем получил столбец A.</li><li>Все столбцы с очень большим весом (&gt;10^298) обрабатываются так, как если бы у них был вес 10^298. Пропорциональные различия между ними (и между столбцами с немного меньшим весом) не учитываются.</li><li>Столбцы с бесконечным весом не обрабатываются правильно. [Фактически невозможно определить вес как бесконечный, но это искусственное ограничение. Его обработка кодом выделения была безуспешной.]</li><li>Несколько мелких проблем при предотвращении переполнения, нехватки данных, потери точности и аналогичных проблем с плавающей запятой.</li><li>Корректировки округления макета неверны при достаточно высоком DPI.</li></ol>Новый алгоритм выдает результаты, соответствующие следующим критериям: А. Фактическая ширина, назначенная *-столбцу, никогда не меньше его минимальной ширины и не больше максимальной ширины. Б. Каждому <em>-столбцу, которому не назначена минимальная или максимальная ширина, назначается ширина пропорционально его <em>-весу. Точнее, если два столбца объявлены с шириной x</em> и y</em> соответственно и ни один из них не получил минимальную или максимальную ширину, у фактических значений ширины v и w, присвоенных столбцам, будет та же пропорция: v / w == x / y. В. Общая ширина, выделяемая &quot;пропорциональным&quot; *-столбцам, равна свободному пространству, доступному после выделения для ограниченных столбцов (фиксированных, автоматических и *-столбцов, которым выделена минимальная или максимальная ширина). Это значение может быть равно нулю, например, если сумма минимальных значений ширины превышает доступную ширину сетки. Г. Все эти инструкции должны интерпретироваться по отношению к гипотетическому &quot;идеальному&quot; макету. Если действует округление макета, фактические значения ширины могут отличаться от идеальных максимум на один пиксель. Старый алгоритм учитывал (А), но не учитывал другие критерии в случаях, описанных выше. Все сказанное в этой статье относительно столбцов и их ширины также применяется к строкам и их высоте.|
|Предложение|По умолчанию приложения, предназначенные для версий .NET Framework 4.7 и выше, будут использовать новый алгоритм, а приложения, предназначенные для .NET Framework 4.6.2 и более ранних версий, — старый алгоритм. Чтобы переопределить поведение по умолчанию, используйте следующий параметр конфигурации:<pre><code class="language-xml">&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.System.Windows.Controls.Grid.StarDefinitionsCanExceedAvailableSpace=true&quot; /&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;</code></pre>Значение true позволяет выбрать старый алгоритм, а false — новый.|
|Область|Дополнительный номер|
|Версия|4.7|
|Тип|Изменение целевой платформы|

