<span data-ttu-id="98752-101">С помощью символьных индексирование с <xref:System.Text.StringBuilder.Chars%2A> свойство может быть резко снизит скорость обработки при следующих условиях:</span><span class="sxs-lookup"><span data-stu-id="98752-101">Using character-based indexing with the <xref:System.Text.StringBuilder.Chars%2A> property can be extremely slow under the following conditions:</span></span>

- <span data-ttu-id="98752-102"><xref:System.Text.StringBuilder> Экземпляр велико (например, он состоит из нескольких десятков тысяч символов).</span><span class="sxs-lookup"><span data-stu-id="98752-102">The <xref:System.Text.StringBuilder> instance is large (for example, it consists of several tens of thousands of characters).</span></span>
- <span data-ttu-id="98752-103"><xref:System.Text.StringBuilder> — «Фрагментированных».</span><span class="sxs-lookup"><span data-stu-id="98752-103">The <xref:System.Text.StringBuilder> is "chunky."</span></span> <span data-ttu-id="98752-104">То есть, таких как повторные вызовы методов <xref:System.Text.StringBuilder.Append%2A?displayProperty=nameWithType> которых автоматически увеличен объекта <xref:System.Text.StringBuilder.Capacity%2A?displayProperty=nameWithType> свойства и выделенный новые блоки памяти, к нему.</span><span class="sxs-lookup"><span data-stu-id="98752-104">That is, repeated calls to methods such as <xref:System.Text.StringBuilder.Append%2A?displayProperty=nameWithType> have automatically expanded the object's <xref:System.Text.StringBuilder.Capacity%2A?displayProperty=nameWithType> property and allocated new chunks of memory to it.</span></span>

<span data-ttu-id="98752-105">Поскольку каждый символ доступа проходит весь связанный список блоков данных, чтобы найти правильные буфера индекса в серьезно влияет на производительность.</span><span class="sxs-lookup"><span data-stu-id="98752-105">Performance is severely impacted because each character access walks the entire linked list of chunks to find the correct buffer to index into.</span></span>

> [!NOTE]
>  <span data-ttu-id="98752-106">Даже для большого «фрагментированных» <xref:System.Text.StringBuilder> объекту с помощью <xref:System.Text.StringBuilder.Chars%2A> свойство для доступа на основе индекса для одного или небольшое число символов может повлиять на производительность незначительно; как правило, это **0(n)** операции.</span><span class="sxs-lookup"><span data-stu-id="98752-106">Even for a large "chunky" <xref:System.Text.StringBuilder> object, using the <xref:System.Text.StringBuilder.Chars%2A> property for index-based access to one or a small number of characters has a negligible performance impact; typically, it is an **0(n)** operation.</span></span> <span data-ttu-id="98752-107">Значительно снижает производительность происходит во время итерации символов в <xref:System.Text.StringBuilder> объекта, имеющего **O(n^2)** операции.</span><span class="sxs-lookup"><span data-stu-id="98752-107">The significant performance impact occurs when iterating the characters in the <xref:System.Text.StringBuilder> object, which is an **O(n^2)** operation.</span></span> 

<span data-ttu-id="98752-108">Если возникли проблемы с производительностью при использовании символьного индексирование с <xref:System.Text.StringBuilder> объектов, которые можно использовать любой из следующих действий:</span><span class="sxs-lookup"><span data-stu-id="98752-108">If you encounter performance issues when using character-based indexing with <xref:System.Text.StringBuilder> objects, you can use any of the following workarounds:</span></span>

- <span data-ttu-id="98752-109">Преобразовать <xref:System.Text.StringBuilder> экземпляр <xref:System.String> путем вызова <xref:System.Text.StringBuilder.ToString%2A> метод, затем получить доступ к символов в строке.</span><span class="sxs-lookup"><span data-stu-id="98752-109">Convert the <xref:System.Text.StringBuilder> instance to a <xref:System.String> by calling the <xref:System.Text.StringBuilder.ToString%2A> method, then access the characters in the string.</span></span>

- <span data-ttu-id="98752-110">Скопируйте содержимое существующего <xref:System.Text.StringBuilder> новый выделенный размер <xref:System.Text.StringBuilder> объекта.</span><span class="sxs-lookup"><span data-stu-id="98752-110">Copy the contents of the existing <xref:System.Text.StringBuilder> object to a new pre-sized <xref:System.Text.StringBuilder> object.</span></span> <span data-ttu-id="98752-111">Повышает производительность, так как новый <xref:System.Text.StringBuilder> объект не фрагментированных.</span><span class="sxs-lookup"><span data-stu-id="98752-111">Performance improves because the new <xref:System.Text.StringBuilder> object is not chunky.</span></span> <span data-ttu-id="98752-112">Пример:</span><span class="sxs-lookup"><span data-stu-id="98752-112">For example:</span></span>

   ```csharp
   // sbOriginal is the existing StringBuilder object
   var sbNew = new StringBuilder(sbOriginal.ToString(), sbOriginal.Length);
   ```
   ```vb
   ' sbOriginal is the existing StringBuilder object
   Dim sbNew = New StringBuilder(sbOriginal.ToString(), sbOriginal.Length)
   ```
- <span data-ttu-id="98752-113">Установить начальную вместимость из <xref:System.Text.StringBuilder> в значение, равное примерно до ожидаемого размера путем вызова <xref:System.Text.StringBuilder.%23ctor(System.Int32)> конструктор.</span><span class="sxs-lookup"><span data-stu-id="98752-113">Set the initial capacity of the <xref:System.Text.StringBuilder> object to a value that is approximately equal to its maximum expected size by calling the <xref:System.Text.StringBuilder.%23ctor(System.Int32)> constructor.</span></span> <span data-ttu-id="98752-114">Обратите внимание, что это выделяет весь блок памяти, даже если <xref:System.Text.StringBuilder> редко достигает своего максимального размера.</span><span class="sxs-lookup"><span data-stu-id="98752-114">Note that this allocates the entire block of memory even if the <xref:System.Text.StringBuilder> rarely reaches its maximum capacity.</span></span>
